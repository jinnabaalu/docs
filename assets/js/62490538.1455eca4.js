"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2806],{7365:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"k8s-cluster/Pre-requisites","title":"Pre-requisites","description":"- Enable iptables Bridged Traffic","source":"@site/docs/k8s-cluster/Pre-requisites.md","sourceDirName":"k8s-cluster","slug":"/k8s-cluster/Pre-requisites","permalink":"/oio/docs/k8s-cluster/Pre-requisites","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/k8s-cluster/Pre-requisites.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"K8s Cluster","permalink":"/oio/docs/category/k8s-cluster"},"next":{"title":"Join the  control-plane node","permalink":"/oio/docs/k8s-cluster/JoinControlPlaneNode"}}');var r=n(4848),i=n(8453);const l={sidebar_position:1},a="Pre-requisites",c={},o=[{value:"Enable iptables Bridged Traffic",id:"enable-iptables-bridged-traffic",level:4},{value:"Disable swap",id:"disable-swap",level:4},{value:"Install CRI-O Runtime",id:"install-cri-o-runtime",level:4},{value:"Install kubeadm, kubelet, and kubectl",id:"install-kubeadm-kubelet-and-kubectl",level:4},{value:"Set KUBELET_EXTRA_ARGS",id:"set-kubelet_extra_args",level:4},{value:"Install Callico Network Plugin",id:"install-callico-network-plugin",level:4},{value:"Setup Kubernetes Metrics Server",id:"setup-kubernetes-metrics-server",level:4}];function d(e){const s={a:"a",code:"code",h1:"h1",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"pre-requisites",children:"Pre-requisites"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Enable iptables Bridged Traffic"}),"\n",(0,r.jsx)(s.li,{children:"Disable Swap (Important for Kubernetes)"}),"\n",(0,r.jsx)(s.li,{children:"Install CRI-O Runtime"}),"\n",(0,r.jsx)(s.li,{children:"Install kubeadm, kubelet, and kubectl"}),"\n",(0,r.jsx)(s.li,{children:"Set KUBELET_EXTRA_ARGS"}),"\n",(0,r.jsx)(s.li,{children:"Install Calico Network"}),"\n"]}),"\n",(0,r.jsx)(s.h4,{id:"enable-iptables-bridged-traffic",children:"Enable iptables Bridged Traffic"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\nbr_netfilter\noverlay\nEOF\n\nsudo modprobe br_netfilter\nsudo modprobe overlay\n\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOF\n\nsudo sysctl --system\n"})}),"\n",(0,r.jsx)(s.h4,{id:"disable-swap",children:"Disable swap"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'sudo swapoff -a\n(crontab -l 2>/dev/null; echo "@reboot /sbin/swapoff -a") | crontab - || true\n'})}),"\n",(0,r.jsx)(s.h4,{id:"install-cri-o-runtime",children:"Install CRI-O Runtime"}),"\n",(0,r.jsxs)(s.p,{children:["CRI - Container Runtime Interface using Open container initiative\n",(0,r.jsx)(s.a,{href:"https://cri-o.io/",children:"https://cri-o.io/"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'sudo apt-get update -y\nsudo apt-get install -y software-properties-common curl apt-transport-https ca-certificates\n\ncurl -fsSL https://pkgs.k8s.io/addons:/cri-o:/prerelease:/main/deb/Release.key |\n    gpg --dearmor -o /etc/apt/keyrings/cri-o-apt-keyring.gpg\necho "deb [signed-by=/etc/apt/keyrings/cri-o-apt-keyring.gpg] https://pkgs.k8s.io/addons:/cri-o:/prerelease:/main/deb/ /" |\n    tee /etc/apt/sources.list.d/cri-o.list\n\nsudo apt-get update -y\nsudo apt-get install -y cri-o\n\nsudo systemctl daemon-reload\nsudo systemctl enable crio --now\nsudo systemctl start crio.service\n'})}),"\n",(0,r.jsxs)(s.p,{children:["Why we are not using docker : ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/blog/2022/02/17/dockershim-faq/",children:"https://kubernetes.io/blog/2022/02/17/dockershim-faq/"})]}),"\n",(0,r.jsxs)(s.p,{children:["Install ",(0,r.jsx)(s.code,{children:"crictl"})," and ",(0,r.jsx)(s.code,{children:"critest"})," , ",(0,r.jsx)(s.a,{href:"https://github.com/kubernetes-sigs/cri-tools",children:"https://github.com/kubernetes-sigs/cri-tools"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'VERSION="v1.31.1"\nwget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz\nsudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin\nrm -f crictl-$VERSION-linux-amd64.tar.gz\n\n\n\nVERSION="v1.31.1"\nwget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/critest-$VERSION-linux-amd64.tar.gz\nsudo tar zxvf critest-$VERSION-linux-amd64.tar.gz -C /usr/local/bin\nrm -f critest-$VERSION-linux-amd64.tar.gz\n'})}),"\n",(0,r.jsx)(s.h4,{id:"install-kubeadm-kubelet-and-kubectl",children:"Install kubeadm, kubelet, and kubectl"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'\nsudo mkdir -p /etc/apt/keyrings\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list\n\nsudo apt update\n# Fin the latest version \napt-cache madison kubeadm | tac\n\nsudo apt-get install -y kubelet=1.31.1-1.1 kubectl=1.31.1-1.1 kubeadm=1.31.1-1.1\n\nsudo apt-mark hold kubelet kubeadm kubectl\n'})}),"\n",(0,r.jsx)(s.p,{children:"Above steps are needed for every node in the cluster"}),"\n",(0,r.jsx)(s.h4,{id:"set-kubelet_extra_args",children:"Set KUBELET_EXTRA_ARGS"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'sudo apt-get install -y jq\nlocal_ip="$(ip --json addr show eth0 | jq -r \'.[0].addr_info[] | select(.family == "inet") | .local\')"\ncat > /etc/default/kubelet << EOF\nKUBELET_EXTRA_ARGS=--node-ip=$local_ip\nEOF\n\ncat /etc/default/kubelet\n'})}),"\n",(0,r.jsx)(s.h4,{id:"install-callico-network-plugin",children:"Install Callico Network Plugin"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\n\nkubectl get po -n kube-system\n"})}),"\n",(0,r.jsx)(s.h4,{id:"setup-kubernetes-metrics-server",children:"Setup Kubernetes Metrics Server"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"$ kubectl top nodes\n$ kubectl apply -f https://raw.githubusercontent.com/techiescamp/kubeadm-scripts/main/manifests/metrics-server.yaml\n$ kubectl top nodes\nNAME                   CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\nargocd-grafana         58m          0%     1587Mi          10%\nharbour-vm             57m          1%     1572Mi          20%\ndevops            288m         1%     1842Mi          2%\nqxydevrunnervm1        189m         1%     6054Mi          9%\nself-hosted-runner-3   53m          1%     1061Mi          6%\nselfhosted-runner-2    81m          2%     1649Mi          10%\n\n$ kubectl top pod -n kube-system \nNAME                                       CPU(cores)   MEMORY(bytes)\ncalico-kube-controllers-6879d4fcdc-s8v94   3m           15Mi\ncalico-node-4v2v8                          22m          77Mi\ncalico-node-665qh                          49m          86Mi\ncalico-node-pcl75                          62m          85Mi\ncalico-node-rv9rd                          32m          82Mi\ncalico-node-vl4k9                          20m          77Mi\ncalico-node-vlpz2                          25m          77Mi\ncoredns-7c65d6cfc9-qf5x9                   4m           14Mi\ncoredns-7c65d6cfc9-qr67f                   4m           14Mi\netcd-devops                           56m          68Mi\nkube-apiserver-devops                 105m         319Mi\nkube-controller-manager-devops        33m          56Mi\nkube-proxy-4bh75                           2m           13Mi\nkube-proxy-7nxq5                           1m           13Mi\nkube-proxy-cx7j9                           1m           14Mi\nkube-proxy-h29dq                           1m           12Mi\nkube-proxy-kgmq8                           1m           12Mi\nkube-proxy-ldtsm                           1m           12Mi\nkube-scheduler-devops                 7m           19Mi\nmetrics-server-78999cb768-fjs49            8m           21Mi\n"})})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var t=n(6540);const r={},i=t.createContext(r);function l(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);