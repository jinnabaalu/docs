"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2425],{7104:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"elasticsearch/EnableXPackInKibanaContainer","title":"\ud83d\udc33 Enable XPack in Kibana Container","description":"Secure Kibana connection with Elasticsearch over SSL \u2014 production-ready container setup","source":"@site/docs/elasticsearch/EnableXPackInKibanaContainer.md","sourceDirName":"elasticsearch","slug":"/ElasticStack/EnableXPackInKibanaContainer","permalink":"/oio/docs/ElasticStack/EnableXPackInKibanaContainer","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/elasticsearch/EnableXPackInKibanaContainer.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\ud83d\udc33 Enable XPack in Kibana Container","description":"Secure Kibana connection with Elasticsearch over SSL \u2014 production-ready container setup","slug":"/ElasticStack/EnableXPackInKibanaContainer"},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udc33 Enable XPack in Elasticsearch Container","permalink":"/oio/docs/ElasticStack/EnableXPackInElasticsearchContainer"},"next":{"title":"\ud83d\udc33 Enable XPack in Logstash Container","permalink":"/oio/docs/ElasticStack/EnableXPackInLogstashContainer"}}');var t=s(4848),i=s(8453);const r={sidebar_position:7,title:"\ud83d\udc33 Enable XPack in Kibana Container",description:"Secure Kibana connection with Elasticsearch over SSL \u2014 production-ready container setup",slug:"/ElasticStack/EnableXPackInKibanaContainer"},c="\ud83d\udc33 Enable XPack in Kibana Container",o={},l=[{value:"\u2705 Preflight Checklist",id:"-preflight-checklist",level:2},{value:"\ud83d\udcdc What&#39;s the Deal with ca.crt?",id:"-whats-the-deal-with-cacrt",level:2},{value:"\ud83d\udc33 Download the Docker Compose",id:"-download-the-docker-compose",level:2},{value:"\ud83d\udee0\ufe0f Create the <code>.env</code> File",id:"\ufe0f-create-the-env-file",level:2},{value:"\ud83d\ude80 Spin Up the Kibana Container",id:"-spin-up-the-kibana-container",level:2},{value:"Check container status: <code>docker ps -a</code>\nLook for <strong>kibana</strong> \u2014 it will stay starting until you set the <code>kibana_system</code> user password.",id:"check-container-status-docker-ps--alook-for-kibana--it-will-stay-starting-until-you-set-the-kibana_system-user-password",level:2},{value:"\ud83d\udd10 Set kibana_system Password",id:"-set-kibana_system-password",level:2},{value:"\ud83c\udfaf Access the Kibana UI",id:"-access-the-kibana-ui",level:2},{value:"\ud83d\udea8 Common Errors and Pitfalls",id:"-common-errors-and-pitfalls",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"-enable-xpack-in-kibana-container",children:"\ud83d\udc33 Enable XPack in Kibana Container"})}),"\n",(0,t.jsxs)(n.p,{children:["Secure it. Connect it. Run it. \ud83d\ude80",(0,t.jsx)(n.br,{}),"\n","Let\u2019s hook up ",(0,t.jsx)(n.strong,{children:"Kibana"})," to your SSL-secured ",(0,t.jsx)(n.strong,{children:"Elasticsearch"})," node \u2014 the ",(0,t.jsx)(n.em,{children:"right"})," way."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-preflight-checklist",children:"\u2705 Preflight Checklist"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use the ",(0,t.jsx)(n.strong,{children:"same certificates"})," you generated when securing Elasticsearch."]}),"\n",(0,t.jsxs)(n.li,{children:["Place the ",(0,t.jsx)(n.code,{children:"certs/"})," folder in the ",(0,t.jsx)(n.strong,{children:"current working directory"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Elasticsearch"})," must already be ",(0,t.jsx)(n.strong,{children:"up, healthy, and SSL-enabled"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Networking tip"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If Kibana and Elasticsearch are ",(0,t.jsx)(n.strong,{children:"on the same machine"}),", use Docker container names as hosts and ",(0,t.jsx)(n.strong,{children:"share the same Docker network"})," (",(0,t.jsx)(n.code,{children:"elknet"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["If ",(0,t.jsx)(n.strong,{children:"remote"}),", use the ",(0,t.jsx)(n.strong,{children:"private IP"})," or ",(0,t.jsx)(n.strong,{children:"resolvable hostname"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"No network = No connection."})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Since Elasticsearch is now SSL-secured, ",(0,t.jsx)(n.strong,{children:"Kibana must trust the Elasticsearch SSL certificate"})," \u2014 that's why we mount the ca.crt file into the container."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-whats-the-deal-with-cacrt",children:"\ud83d\udcdc What's the Deal with ca.crt?"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"ca.crt"})," (Certificate Authority certificate) is \ud83d\udd25 critical because:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It's the root of trust for SSL/TLS connections between Kibana and Elasticsearch."}),"\n",(0,t.jsx)(n.li,{children:"Kibana needs the ca.crt to validate that the Elasticsearch server it's talking to is real and not some random imposter."}),"\n",(0,t.jsx)(n.li,{children:"Without this, SSL handshake will fail hard \u2014 you\u2019ll get errors like unable to verify certificate, bad handshake, or Kibana will just refuse to connect."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"That\u2019s why we mount the certs and tell Kibana:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"- ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt\n"})}),"\n",(0,t.jsx)(n.p,{children:"Bottom Line:\nIf Kibana can't trust the CA, it won't trust Elasticsearch, and your setup will break. \ud83d\udd25"}),"\n",(0,t.jsx)(n.h2,{id:"-download-the-docker-compose",children:"\ud83d\udc33 Download the Docker Compose"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"wget -O docker-compose.yml https://raw.githubusercontent.com/jinnabaalu/ELKOperations/refs/heads/main/kibana/xpack-docker-compose.yml\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h2,{id:"\ufe0f-create-the-env-file",children:["\ud83d\udee0\ufe0f Create the ",(0,t.jsx)(n.code,{children:".env"})," File"]}),"\n",(0,t.jsxs)(n.p,{children:["Create a ",(0,t.jsx)(n.code,{children:".env"})," file alongside your ",(0,t.jsx)(n.code,{children:"docker-compose.yml"}),", with the following vars:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"STACK_VERSION=8.12.0\nKIBANA_PORT=5601\nELASTICSEARCH_HOSTS=https://elasticsearch:9200\nKIBANA_PASSWORD=your_kibana_system_password\nMEM_LIMIT=1g\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Match STACK_VERSION to your Elasticsearch version."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-spin-up-the-kibana-container",children:"\ud83d\ude80 Spin Up the Kibana Container"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"check-container-status-docker-ps--alook-for-kibana--it-will-stay-starting-until-you-set-the-kibana_system-user-password",children:["Check container status: ",(0,t.jsx)(n.code,{children:"docker ps -a"}),"\nLook for ",(0,t.jsx)(n.strong,{children:"kibana"})," \u2014 it will stay starting until you set the ",(0,t.jsx)(n.code,{children:"kibana_system"})," user password."]}),"\n",(0,t.jsx)(n.h2,{id:"-set-kibana_system-password",children:"\ud83d\udd10 Set kibana_system Password"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -s -X POST --cacert ./certs/ca/ca.crt \\\n-u "elastic:${ELASTIC_PASSWORD}" \\\n-H "Content-Type: application/json" \\\nhttps://localhost:9200/_security/user/kibana_system/_password \\\n-d "{\\"password\\":\\"${KIBANA_PASSWORD}\\"}"\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-access-the-kibana-ui",children:"\ud83c\udfaf Access the Kibana UI"}),"\n",(0,t.jsxs)(n.p,{children:["Open your browser: ",(0,t.jsx)(n.a,{href:"https://localhost:5601",children:"https://localhost:5601"})]}),"\n",(0,t.jsx)(n.p,{children:"\u2705 Log in with your elastic user or any other user you've configured."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Now Kibana is talking to Elasticsearch securely over SSL.\nNot a hacky dev setup \u2014 this is ",(0,t.jsx)(n.strong,{children:"production-grade"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"-common-errors-and-pitfalls",children:"\ud83d\udea8 Common Errors and Pitfalls"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If you don\u2019t set ",(0,t.jsx)(n.code,{children:"kibana_system"})," password properly = Kibana will ",(0,t.jsx)(n.strong,{children:"crash-loop"})," or ",(0,t.jsx)(n.strong,{children:"stay unhealthy forever"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Wrong certs path? You\u2019ll get ",(0,t.jsx)(n.strong,{children:"SSL errors"})," (",(0,t.jsx)(n.code,{children:"unable to verify the first certificate"}),", ",(0,t.jsx)(n.code,{children:"bad handshake"}),", etc.)."]}),"\n",(0,t.jsxs)(n.li,{children:["Kibana ",(0,t.jsx)(n.strong,{children:"must"})," trust Elasticsearch CA. Always point it to ",(0,t.jsx)(n.code,{children:"ca.crt"}),"."]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var a=s(6540);const t={},i=a.createContext(t);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);