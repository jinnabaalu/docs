"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9132],{8422:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"elasticsearch/EnableXPackInLogstashContainer","title":"\ud83d\udc33 Enable XPack in Logstash Container","description":"Secure Logstash to Elasticsearch communication over SSL \u2014 production-ready container setup","source":"@site/docs/elasticsearch/EnableXPackInLogstashContainer.md","sourceDirName":"elasticsearch","slug":"/ElasticStack/EnableXPackInLogstashContainer","permalink":"/oio/docs/ElasticStack/EnableXPackInLogstashContainer","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/elasticsearch/EnableXPackInLogstashContainer.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\ud83d\udc33 Enable XPack in Logstash Container","description":"Secure Logstash to Elasticsearch communication over SSL \u2014 production-ready container setup","slug":"/ElasticStack/EnableXPackInLogstashContainer"},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udc33 Enable XPack in Kibana Container","permalink":"/oio/docs/ElasticStack/EnableXPackInKibanaContainer"},"next":{"title":"Elasticsearch Reindexing API","permalink":"/oio/docs/elasticsearch/2022-05-02-Reindexing-Guide"}}');var a=s(4848),r=s(8453);const i={sidebar_position:8,title:"\ud83d\udc33 Enable XPack in Logstash Container",description:"Secure Logstash to Elasticsearch communication over SSL \u2014 production-ready container setup",slug:"/ElasticStack/EnableXPackInLogstashContainer"},c="\ud83d\udc33 Enable XPack in Logstash Container",o={},l=[{value:"\u2705 Preflight Checklist",id:"-preflight-checklist",level:2},{value:"\ud83d\udcdc Why ca.crt Again?",id:"-why-cacrt-again",level:2},{value:"\ud83d\udc33 Download the Docker Compose",id:"-download-the-docker-compose",level:2},{value:"\ud83d\udee0\ufe0f Create the .env File",id:"\ufe0f-create-the-env-file",level:3},{value:"\ud83d\ude80 Spin Up the Logstash Container",id:"-spin-up-the-logstash-container",level:3},{value:"\ud83c\udfaf Final Touch \u2014 Logstash Pipeline",id:"-final-touch--logstash-pipeline",level:2},{value:"\ud83d\udea8 Common Errors and Pitfalls",id:"-common-errors-and-pitfalls",level:2}];function h(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"-enable-xpack-in-logstash-container",children:"\ud83d\udc33 Enable XPack in Logstash Container"})}),"\n",(0,a.jsxs)(n.p,{children:["Secure it. Connect it. Run it. \ud83d\ude80",(0,a.jsx)(n.br,{}),"\n","Let\u2019s hook up ",(0,a.jsx)(n.strong,{children:"Logstash"})," to your SSL-secured ",(0,a.jsx)(n.strong,{children:"Elasticsearch"})," node \u2014 no excuses."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-preflight-checklist",children:"\u2705 Preflight Checklist"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Elasticsearch"})," must be ",(0,a.jsx)(n.strong,{children:"running, healthy, and SSL-enabled"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Certs?"})," Use the ",(0,a.jsxs)(n.strong,{children:["same ",(0,a.jsx)(n.code,{children:"certs/"})," folder"]})," generated when securing Elasticsearch."]}),"\n",(0,a.jsxs)(n.li,{children:["Place ",(0,a.jsx)(n.code,{children:"certs/"})," folder ",(0,a.jsx)(n.strong,{children:"next to your docker-compose file"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Network matters"}),":","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Same host? Use container names and ",(0,a.jsx)(n.strong,{children:"elknet"})," network."]}),"\n",(0,a.jsxs)(n.li,{children:["Remote? Use ",(0,a.jsx)(n.strong,{children:"private IP"})," or ",(0,a.jsx)(n.strong,{children:"resolvable DNS name"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"No certs = No SSL trust = Logstash won't even start."})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-why-cacrt-again",children:"\ud83d\udcdc Why ca.crt Again?"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"ca.crt"})," is the root certificate \u2014"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Logstash needs it to ",(0,a.jsx)(n.strong,{children:"validate Elasticsearch SSL"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["No valid CA? SSL handshake fails, Logstash ",(0,a.jsx)(n.strong,{children:"crash loops"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Mounted via:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"- ./certs:/usr/share/logstash/config/certs\n"})}),"\n",(0,a.jsx)(n.p,{children:"Referenced in env:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'monitoring.elasticsearch.ssl.certificate_authority: "/usr/share/logstash/config/certs/ca/ca.crt"\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-download-the-docker-compose",children:"\ud83d\udc33 Download the Docker Compose"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"wget -O docker-compose.yml https://raw.githubusercontent.com/jinnabaalu/ELKOperations/refs/heads/main/logstash/postgres-to-elasticsearch/xpack-docker-compose.yml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\ufe0f-create-the-env-file",children:"\ud83d\udee0\ufe0f Create the .env File"}),"\n",(0,a.jsxs)(n.p,{children:["Create a ",(0,a.jsx)(n.code,{children:".env"})," next to your docker-compose:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"STACK_VERSION=9.0.0\nELASTIC_PASSWORD=your_elastic_password\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Match STACK_VERSION to what Elasticsearch is running."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"-spin-up-the-logstash-container",children:"\ud83d\ude80 Spin Up the Logstash Container"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Check container status: ",(0,a.jsx)(n.code,{children:"docker ps -a"})]}),"\n",(0,a.jsx)(n.p,{children:"Look for logstash \u2014 it should start healthy once certs and credentials are correct."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-final-touch--logstash-pipeline",children:"\ud83c\udfaf Final Touch \u2014 Logstash Pipeline"}),"\n",(0,a.jsx)(n.p,{children:"Logstash will do nothing unless you configure pipelines."}),"\n",(0,a.jsxs)(n.p,{children:["Make sure you have a pipeline file under: ",(0,a.jsx)(n.code,{children:"./pipeline/"})]}),"\n",(0,a.jsx)(n.p,{children:"Example simple input/output if you just wanna test it:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'input { stdin { } }\noutput {\n  elasticsearch {\n    hosts => ["https://elasticsearch:9200"]\n    user => "elastic"\n    password => "${ELASTIC_PASSWORD}"\n    cacert => "/usr/share/logstash/config/certs/ca/ca.crt"\n    index => "test-index"\n  }\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-common-errors-and-pitfalls",children:"\ud83d\udea8 Common Errors and Pitfalls"}),"\n",(0,a.jsxs)(n.p,{children:["Wrong CA cert? => Logstash won't even pass ",(0,a.jsx)(n.code,{children:"bin/logstash -t"})]}),"\n",(0,a.jsxs)(n.p,{children:["Bad elastic password? => ",(0,a.jsx)(n.strong,{children:"Authentication failures"})," in logs."]}),"\n",(0,a.jsxs)(n.p,{children:["No pipeline? => Logstash runs but ",(0,a.jsx)(n.strong,{children:"looks dead"})," (because no data flowing)."]}),"\n",(0,a.jsx)(n.p,{children:"Treat your pipelines and certs like first-class citizens."})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var t=s(6540);const a={},r=t.createContext(a);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);