"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9316],{8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>l});var t=n(6540);const i={},o=t.createContext(i);function a(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:s},e.children)}},8968:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"elasticsearch/2019-09-17-Elasticsearch-Slow-Query-Log-Conf","title":"2019-09-17-Elasticsearch-Slow-Query-Log-Conf","description":"Slow Logs in Elasticsearch","source":"@site/docs/elasticsearch/2019-09-17-Elasticsearch-Slow-Query-Log-Conf.md","sourceDirName":"elasticsearch","slug":"/elasticsearch/2019-09-17-Elasticsearch-Slow-Query-Log-Conf","permalink":"/oio/docs/elasticsearch/2019-09-17-Elasticsearch-Slow-Query-Log-Conf","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/elasticsearch/2019-09-17-Elasticsearch-Slow-Query-Log-Conf.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"\ud83e\udee7 Introduction","permalink":"/oio/docs/Logstash"},"next":{"title":"2019-09-17-Create-Indexes-and-Data","permalink":"/oio/docs/elasticsearch/2019-09-17-Create-Indexes-and-Data"}}');var i=n(4848),o=n(8453);const a={sidebar_position:12},l=void 0,c={},r=[{value:"Slow Logs in Elasticsearch",id:"slow-logs-in-elasticsearch",level:2},{value:"Search Slow Logs",id:"search-slow-logs",level:3},{value:"Search in Elasticsearch happens in two phases:",id:"search-in-elasticsearch-happens-in-two-phases",level:4},{value:"Index Slow Logs",id:"index-slow-logs",level:3},{value:"Configuration sin elasticsearch",id:"configuration-sin-elasticsearch",level:3}];function h(e){const s={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"slow-logs-in-elasticsearch",children:"Slow Logs in Elasticsearch"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Search slow logs - used to log the searches which are slow"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"Index slow logs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"search-slow-logs",children:"Search Slow Logs"}),"\n",(0,i.jsx)(s.p,{children:"Search slow logs are used to log the searches which are slow. The slowness threshold depends on the application and its Elasticsearch implementation details. Each application can have different thresholds."}),"\n",(0,i.jsx)(s.h4,{id:"search-in-elasticsearch-happens-in-two-phases",children:"Search in Elasticsearch happens in two phases:"}),"\n",(0,i.jsx)(s.p,{children:"Query phase - In the query phase, Elasticsearch collects document ids of the relevant results. Upon the completion of this phase, only the ids of the documents which are matched against the search are returned, and there will be no other information like the fields or their values, etc.\nFetch phase - In the fetch phase, the documents ids from the query phase are used to fetch the real documents, and with this the search request can be said to be complete.\nSearch slow logs show the split times for both the query and the fetch phases with the query. Thus, we are able to get a complete picture of the time taken to complete the query and the fetch phases, and are able to inspect the entire query itself."}),"\n",(0,i.jsx)(s.h3,{id:"index-slow-logs",children:"Index Slow Logs"}),"\n",(0,i.jsx)(s.h3,{id:"configuration-sin-elasticsearch",children:"Configuration sin elasticsearch"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"elasticsearch.yml"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"jvm.options"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"log4j2.properties"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Run Single node elasticsearch"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"docker compose up -d \n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Create the index"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Create student entity with 1000 records"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -sXPUT \'http://localhost:9200/student/?pretty\' -H \'Content-Type: application/json\' -d \'{\n  "settings" : {\n      "index" : {\n          "number_of_shards" : 5,\n          "number_of_replicas" : 0\n      }\n  }\n}\'\n\nwhile ! curl -s "localhost:9200/_cat/indices?v" | grep green; do\n  sleep 0.1\ndone\n\nfor i in `seq 1 20`; do\n  curl -sXPUT "localhost:9200/student/$i?pretty" -H \'Content-Type: application/json\' -d "\n  {\n    \\"number\\": $i,\n    \\"name\\": \\"Ram - $i\\"\n  }"\ndone\n'})})]})}function d(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);