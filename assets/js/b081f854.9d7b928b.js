"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7993],{1530:(e,s,c)=>{c.r(s),c.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>n,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"elasticsearch/high-availability-elasticsearch-cluster/RunThreeNodeCluster","title":"\ud83d\udc33 Elasticsearch 3-Node Cluster Setup","description":"Spin up a high-availability, secure Elasticsearch cluster with Docker.","source":"@site/docs/elasticsearch/high-availability-elasticsearch-cluster/RunThreeNodeCluster.md","sourceDirName":"elasticsearch/high-availability-elasticsearch-cluster","slug":"/ElasticStack/elasticsearch-3-node","permalink":"/oio/docs/ElasticStack/elasticsearch-3-node","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/elasticsearch/high-availability-elasticsearch-cluster/RunThreeNodeCluster.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"\ud83d\udc33 Elasticsearch 3-Node Cluster Setup","description":"Spin up a high-availability, secure Elasticsearch cluster with Docker.","slug":"/ElasticStack/elasticsearch-3-node"},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udc33 How to Define a Highly Available Elasticsearch Cluster","permalink":"/oio/docs/ElasticStack/UnderstandHACluster"},"next":{"title":"\ud83d\udc33 Elasticsearch 3-Node Cluster Failure Simulation","permalink":"/oio/docs/ElasticStack/Elasticsearch-3-NodeClusterFailureSimulation"}}');var t=c(4848),a=c(8453);const n={sidebar_position:2,title:"\ud83d\udc33 Elasticsearch 3-Node Cluster Setup",description:"Spin up a high-availability, secure Elasticsearch cluster with Docker.",slug:"/ElasticStack/elasticsearch-3-node"},i="\ud83d\udc33 Elasticsearch 3-Node Cluster Setup",l={},o=[{value:"\ud83d\udcc2 Folder Structure",id:"-folder-structure",level:2},{value:"\ud83d\ude80 Steps to Get It Running",id:"-steps-to-get-it-running",level:2},{value:"Create Directories",id:"create-directories",level:3},{value:"Download the Files",id:"download-the-files",level:3},{value:"Generate SSL Certs",id:"generate-ssl-certs",level:3},{value:"OUTPUT",id:"output",level:4},{value:"Copy Certs",id:"copy-certs",level:3},{value:"Spin Up the Containers",id:"spin-up-the-containers",level:3},{value:"Elasticsearch-1",id:"elasticsearch-1",level:4},{value:"Elasticsearch-2",id:"elasticsearch-2",level:4},{value:"For Elasticsearch-3",id:"for-elasticsearch-3",level:4},{value:"\ud83d\udd12 Secure by Default",id:"-secure-by-default",level:2},{value:"\ud83d\udea8 What\u2019s Next?",id:"-whats-next",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"-elasticsearch-3-node-cluster-setup",children:"\ud83d\udc33 Elasticsearch 3-Node Cluster Setup"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"TL;DR:"})," Spin up a 3-node Elasticsearch cluster with SSL/TLS using Docker. It's secure, fast, and easy to deploy. Let's roll!"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Github Repo"}),": ",(0,t.jsx)(s.a,{href:"https://github.com/jinnabaalu/ELKOperations/tree/main/elasticsearch/three-node",children:"Elaasticsearch Three Node Cluster with XPack"})]}),"\n",(0,t.jsx)(s.h2,{id:"-folder-structure",children:"\ud83d\udcc2 Folder Structure"}),"\n",(0,t.jsx)(s.p,{children:"First, set up the directory like this:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"three-node/\n\u251c\u2500\u2500 certs-generator\n\u2502   \u251c\u2500\u2500 docker-compose.yml\n\u2502   \u2514\u2500\u2500 instances.yml\n\u251c\u2500\u2500 elasticsearch-1\n\u2502   \u251c\u2500\u2500 .env\n\u2502   \u2514\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 elasticsearch-2\n\u2502   \u251c\u2500\u2500 .env\n\u2502   \u2514\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 elasticsearch-3\n    \u251c\u2500\u2500 .env\n    \u2514\u2500\u2500 docker-compose.yml\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"-steps-to-get-it-running",children:"\ud83d\ude80 Steps to Get It Running"}),"\n",(0,t.jsx)(s.h3,{id:"create-directories",children:"Create Directories"}),"\n",(0,t.jsx)(s.p,{children:"Run this to make the folder structure:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"mkdir -p three-node/certs-generator\nmkdir -p three-node/elasticsearch-1\nmkdir -p three-node/elasticsearch-2\nmkdir -p three-node/elasticsearch-3\ncd three-node\n"})}),"\n",(0,t.jsx)(s.h3,{id:"download-the-files",children:"Download the Files"}),"\n",(0,t.jsxs)(s.p,{children:["Fetch the required files with ",(0,t.jsx)(s.code,{children:"wget"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# For cert generator and instances file\nTHREE_NODE_CONF_PATH=https://raw.githubusercontent.com/jinnabaalu/ELKOperations/refs/heads/main/elasticsearch/three-node/\nwget -O certs-generator/instances.yml {} ${THREE_NODE_CONF_PATH}/certs-generator/instances.yml\nwget -O certs-generator/docker-compose.yml ${THREE_NODE_CONF_PATH}/certs-generator/docker-compose.yml\n\n# For each Elasticsearch node\nwget -O elasticsearch-1/docker-compose.yml ${THREE_NODE_CONF_PATH}/elasticsearch-1/docker-compose.yml\nwget -O elasticsearch-2/docker-compose.yml ${THREE_NODE_CONF_PATH}/elasticsearch-2/docker-compose.yml\nwget -O elasticsearch-3/docker-compose.yml ${THREE_NODE_CONF_PATH}/elasticsearch-3/docker-compose.yml\nwget -O docker-compose.yml ${THREE_NODE_CONF_PATH}/elasticsearch-3/docker-compose.yml\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Create the ",(0,t.jsx)(s.code,{children:".env"})," in each folder with the following content"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"STACK_VERSION=9.0.0\nES_PORT=9200 # if you are running remote this port usage will not effect the other container\nCLUSTER_NAME=YOUR_CLUSTER_NAME\nELASTIC_PASSWORD=CHANGE_ME\nMEM_LIMIT=4g\n"})}),"\n",(0,t.jsx)(s.h3,{id:"generate-ssl-certs",children:"Generate SSL Certs"}),"\n",(0,t.jsx)(s.p,{children:"Now, head to the certs-generator folder and fire up Docker"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd certs-generator\ndocker compose up -d    \n"})}),"\n",(0,t.jsx)(s.p,{children:"This will generate the SSL certs in the certs/ directory."}),"\n",(0,t.jsx)(s.h4,{id:"output",children:"OUTPUT"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"balu@BaaluMac certs-generator % docker compose up -d\n[+] Running 2/2\n \u2714 Network certs-generator_default  Created                                                           0.2s\n \u2714 Container elastic-certgen        Started                                                           0.5s\nbalu@BaaluMac certs-generator % docker logs -f elastic-certgen\n\u2705 Done generating certs in ./certs\n^C%\nbalu@BaaluMac certs-generator % tree\n.\n\u251c\u2500\u2500 certs\n\u2502\xa0\xa0 \u251c\u2500\u2500 ca\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 ca.key\n\u2502\xa0\xa0 \u251c\u2500\u2500 ca.zip\n\u2502\xa0\xa0 \u251c\u2500\u2500 certs.zip\n\u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-1\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-1.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-1.key\n\u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-2\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-2.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-2.key\n\u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-3\n\u2502\xa0\xa0     \u251c\u2500\u2500 elasticsearch-3.crt\n\u2502\xa0\xa0     \u2514\u2500\u2500 elasticsearch-3.key\n\u251c\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 instances.yml\n\n6 directories, 12 files\n"})}),"\n",(0,t.jsx)(s.p,{children:"Once done, clean up"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"docker compose down\n"})}),"\n",(0,t.jsx)(s.h3,{id:"copy-certs",children:"Copy Certs"}),"\n",(0,t.jsx)(s.p,{children:"Move the generated certs to each node\u2019s certs/ folder:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"mkdir elasticsearch-1/certs/\ncp -r certs-generator/certs/elasticsearch-1 elasticsearch-1/certs/\ncp -r certs-generator/certs/ca elasticsearch-1/certs\n\nmkdir elasticsearch-2/certs/\ncp -r certs-generator/certs/elasticsearch-2 elasticsearch-2/certs/\ncp -r certs-generator/certs/ca elasticsearch-2/certs/\n\nmkdir elasticsearch-3/certs/\ncp -r certs-generator/certs/elasticsearch-3 elasticsearch-3/certs/\ncp -r certs-generator/certs/ca elasticsearch-3/certs/\n"})}),"\n",(0,t.jsx)(s.p,{children:"Final folder structure should look like this."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:".\n\u251c\u2500\u2500 certs-generator\n\u2502\xa0\xa0 \u251c\u2500\u2500 certs\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 ca.key\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.zip\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 certs.zip\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-1\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-1.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-1.key\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-2\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 elasticsearch-2.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-2.key\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-3\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 elasticsearch-3.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 elasticsearch-3.key\n\u2502\xa0\xa0 \u251c\u2500\u2500 docker-compose.yml\n\u2502\xa0\xa0 \u2514\u2500\u2500 instances.yml\n\u251c\u2500\u2500 elasticsearch-1\n\u2502\xa0\xa0 \u251c\u2500\u2500 .env\n\u2502\xa0\xa0 \u251c\u2500\u2500 certs\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 ca.key\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-1\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 elasticsearch-1.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 elasticsearch-1.key\n\u2502\xa0\xa0 \u2514\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 elasticsearch-2\n\u2502\xa0\xa0 \u251c\u2500\u2500 .env\n\u2502\xa0\xa0 \u251c\u2500\u2500 certs\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 ca.key\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-2\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 elasticsearch-2.crt\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 elasticsearch-2.key\n\u2502\xa0\xa0 \u2514\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 elasticsearch-3\n    \u251c\u2500\u2500 .env\n    \u251c\u2500\u2500 certs\n    \u2502\xa0\xa0 \u251c\u2500\u2500 ca\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ca.crt\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 ca.key\n    \u2502\xa0\xa0 \u2514\u2500\u2500 elasticsearch-3\n    \u2502\xa0\xa0     \u251c\u2500\u2500 elasticsearch-3.crt\n    \u2502\xa0\xa0     \u2514\u2500\u2500 elasticsearch-3.key\n    \u2514\u2500\u2500 docker-compose.yml\n\n19 directories, 30 files\n"})}),"\n",(0,t.jsx)(s.h3,{id:"spin-up-the-containers",children:"Spin Up the Containers"}),"\n",(0,t.jsx)(s.p,{children:"Now, start your Elasticsearch nodes"}),"\n",(0,t.jsx)(s.h4,{id:"elasticsearch-1",children:"Elasticsearch-1"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd elasticsearch-1\ndocker compose up -d\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Check for logs ",(0,t.jsx)(s.code,{children:"docker logs -f elasticsearch-1"})]}),"\n",(0,t.jsx)(s.p,{children:"After healthy it is waiting for cluster formation and shows failed to connect to other nodes."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'docker logs -f elasticsearch-1 | grep "failed to resolve host"`\n'})}),"\n",(0,t.jsx)(s.h4,{id:"elasticsearch-2",children:"Elasticsearch-2"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd elasticsearch-2\ndocker compose up -d\n"})}),"\n",(0,t.jsx)(s.h4,{id:"for-elasticsearch-3",children:"For Elasticsearch-3"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"cd elasticsearch-3\ndocker compose up -d\n"})}),"\n",(0,t.jsx)(s.h2,{id:"-secure-by-default",children:"\ud83d\udd12 Secure by Default"}),"\n",(0,t.jsx)(s.p,{children:"This setup enables SSL/TLS for both HTTP and transport layers, making sure your Elasticsearch cluster is locked down and ready for production."}),"\n",(0,t.jsx)(s.h2,{id:"-whats-next",children:"\ud83d\udea8 What\u2019s Next?"}),"\n",(0,t.jsx)(s.p,{children:"You now have a secure, high-availability Elasticsearch cluster running on Docker."}),"\n",(0,t.jsx)(s.p,{children:"Play around with the configs and add more nodes or scale your setup."}),"\n",(0,t.jsx)(s.p,{children:"Don\u2019t forget to monitor your cluster!"}),"\n",(0,t.jsx)(s.p,{children:"That\u2019s it! Your Elasticsearch cluster is up and running with SSL. \ud83d\udd25"})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,c)=>{c.d(s,{R:()=>n,x:()=>i});var r=c(6540);const t={},a=r.createContext(t);function n(e){const s=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:n(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);